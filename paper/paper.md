---
title: 'VICTORIA, the Voxel Interactive Contour Tool for Online Radiation Intensity Analytics'
tags:
  - JavaScript
  - medical physics
  - medical imaging
  - web-based software
  - DICOM viewer
authors:
  - name: Elise Badun
    orcid: 0000-0001-7256-855X
    corresponding: true
    affiliation: 1
  - name: Fr\'ed\'eric Tessier
    corresponding: false
    affiliation: 2
  - name: Reid Townson
    corresponding: false
    affiliation: 2
  - name: Ernesto Mainegra-Hing
    corresponding: false
    affiliation: 2
  - name: Margaret-Anne Storey
    corresponding: false
    affiliation: 1
  - name: Magdalena Bazalova-Carter
    corresponding: false
    affiliation: 1
affiliations:
 - name: University of Victoria, Canada
   index: 1
 - name: National Research Council, Canada
   index: 2
date: 1 October 2022
bibliography: paper.bib
---

# Summary

Computed tomography (CT) is an imaging procedure used visualize the inside of the body, and is commonly used by radiologists to identify tumors. When creating a radiation treatment plan, radiotherapy dose distributions are generated to visualize the dose alongside the CT images. The CT and dose files often hold large amounts of data, requiring specific software to visualize them. Many popular software tools exist to visualize these images, but are commonly expensive and require downloads. The goal of VICTORIA is to be an easy tool to view and compare different dose and density files in a standard web browser, requiring no additional software download and installation. VICTORIA was initially developed as a web tool that could easily view and compare phantom and dose files from the EGSnrc toolkit, an Electron Gamma Shower software package by the National Research Council of Canada (NRC). The EGSnrc Monte Carlo (MC) toolkit is a well-known medical physics package that simulates the transport of ionizing radiation through matter [@egsnrc_2021]. It can model the transport of electrons, positrons, and photons with energies ranging from 1 keV to 10 GeV, in user-defined geometries. The EGSnrc package uses custom file types .egsphant and .3ddose, which are formatted plain text files containing phantom and dose information. 

# Statement of need

VICTORIA is a tool for the visualization and comparison of dose distributions with underlying anatomy that is web-accessible, free, designed with security in mind, and available on the web. The viewer should be useful for researchers using EGSnrc file types .egsphant and .3ddose from the EGSnrc toolkit, patients who want a simple tool to view files, or researchers using DICOM Computed Tomography (CT) and DICOM Radiotherapy (RT) Dose files in low- or middle-income countries without access to treatment planning systems. The viewer can be accessed at [the XCITE lab website](http://web.uvic.ca/~bazalova/VICTORIA/)

# Methods
Most of the data visualization capabilities come from D3, a JavaScript library made for producing dynamic data-based displays by binding input to the Document Object Model (DOM) and applying transformations [@bostock_2020]. D3 provides many user interface functions in VICTORIA, particularly data plotting, axes support, click events, zooming, and other changes to the DOM. The dicomParser library from Cornerstone is used to read in and parse DICOM files [@dicomparser_2020]. The other libraries in use are d3-legend, which creates colour-based legends, as well as filesaver and dom-to-image, which assists in saving the volume viewer to PNG [@d3legend_2019; @filesaver_2020; @domtoimage_2017].

# Results

## Supported file formats
The viewer accepts file types of .egsphant, .3ddose, DICOM CT Image, DICOM Radiotherapy (RT) Dose, and DICOM RT Structure Set [@DICOM_2021]. The files can be loaded with drag and drop, or by opening a file manager to navigate through the user directory. Alternatively, there are test files loaded on the site that consist of an egsphant density file, an RT Dose file, and a structure set file of a pediatric patient, for users to test out the website.

## Data display
The ability to view the difference between two dose files is a useful feature. This can allow users to compare two different patient plans generated by either a commercial treatment planning system (TPS) or by MC codes (i.e. EGSnrc or TOPAS), to compare doses calculated by a MC code against a commercial TPS, to compare dose distributions calculated by two difference MC codes, or to compare MC dose distributions calculated with different transport parameters. The dose difference is calculated by dividing each dose matrix by its maximum dose value, then subtracting the second dose matrix from the first, using tri-linear interpolation if the voxel dimensions are different. The panels are navigable by using sliders to move through slice by slice, or by clicking on a point to update the other two panels to the same location.
The density files are displayed as an image, whereas the dose files are displayed as isodose contours. The dose contours are calculated using the D3 contours function, which returns an array of polygons where the input values are greater than the given thresholds, without any smoothing or interpolation [@d3contours_2021]. The default dose contours are from 10% to 100% in 10% increments. An input box at the bottom of the dose contour legend gives the user the option to input custom dose contours that are not already displayed (e.g., 5%). A toggle function is also available to show/hide individual dose contours by clicking the corresponding legend cell. The option to plot the dose profiles is also available when a dose file is loaded. The dose profiles contain the dose data along the cross-hairs where the user clicks in the z, x, and y dimensions.
Similar functionality to the dose contours is available for the ROI contours. The structure sets are matched to the volume by the existing density and dose files, rather than the user selecting which structure set to display. They are matched if they have the same study instance UID or if the extent of the density/dose overlap with the ROI contours. The user can toggle on and off which ROI contours are visible in the volume viewer. If there is a dose file loaded, there is also an option to plot a dose volume histogram (DVH). This will go through each ROI contour in the structure set, determine the dose enclosed by each, and calculate the cumulative dose delivered in each portion of the ROI. Again, toggling the ROI legend will toggle the data shown in the DVH plot.

# Figures

![A volume viewer with a CT Image file and RT Dose file loaded and displayed. The window and level of the density file has been adjusted. The dose profile along the red cross-hairs has been plotted. The ROI contours are shown and the corresponding DVH is plotted beneath the dose profiles. The dose has been normalized to 4500 cGy at 90%, and this is reflected in the DVH x-axis. A few ROI contours have been toggled off.](VICTORIA-example.pdf)

# Acknowledgments
The authors would like to thank the University of Victoria for the Science Undergraduate Research Award, NSERC Discovery Grant and the Canada Research Chair program that partially supported the work.

# References

